import{u as P,_ as U,a as j}from"./QuestionImportExport-OeHxXhkL.js";import{q as F}from"./question-ChUrMfMN.js";import{_ as G,r as i,o as H,a as m,b as u,c as o,w as c,k as r,d as p,e as d,h as T,t as w,l as J,n as K,i as b,g as W,p as X,q as Y}from"./index-BYh7zG4k.js";const Z={class:"choice-questions"},ee={class:"header"},te={key:0,class:"question-content"},ae={class:"question-title"},se={class:"question-options"},ne={class:"option-content"},oe={key:0,class:"question-answer"},le={key:1,class:"question-note"},ie=["onClick"],ce={__name:"ChoiceQuestions",setup(re){const B=[{title:"题目内容",dataIndex:"title",key:"title",ellipsis:!0},{title:"题目类型",dataIndex:"type",key:"type",width:100,customRender:({record:e})=>e.type==="multiple"?"多选题":"单选题"},{title:"分值",dataIndex:"score",key:"score",width:80,align:"center",customRender:({text:e})=>`${e}分`},{title:"操作",key:"action",width:150,fixed:"right"}],g=P(),Q=i(!1),v=i(!1),$=i("新增选择题"),S=i(null),f=i(null),z=i([]),I=i(0),l=i({current:1,size:10,type:0,keyword:""}),V=e=>{var h,y,x,C,q;const t=[];["A","B","C","D","E"].forEach((a,s)=>{const n=5+s*3;e[`param${n}Text`]===a&&e[`param${n+2}Text`]&&t.push({label:a,content:e[`param${n+2}Text`].replace(/^"(.+)"$/,"$1")})});let k=[];return e.answer&&(k=e.answer.replace(/\s+/g,"").split(",")),{id:e.id,title:e.question.trim(),type:(h=e.param2Text)!=null&&h.includes("多选")?"multiple":"single",score:((x=(y=e.param3Text)==null?void 0:y.match(/\d+/))==null?void 0:x[0])||0,options:t,answer:k,explanation:((q=(C=e.param23Text)==null?void 0:C.replace("本题得分：",""))==null?void 0:q.trim())||"",note:e.param26Text||""}},_=async()=>{Q.value=!0;try{console.log("请求参数:",l.value);const e=await F.getQuestionList({...l.value,type:0});z.value=e.items.records.map(V),I.value=e.items.total}catch{r.error("获取题目列表失败")}finally{Q.value=!1}},E=()=>{l.value.current=1,_()},L=(e,t)=>{console.log("当前页码:",e),l.value={...l.value,current:e,size:t},_()},N=()=>{$.value="新增选择题",f.value=null,v.value=!0},R=e=>{$.value="编辑选择题";const t=X(e);typeof t.answer=="string"&&(t.answer=t.answer.replace(/\s+/g,"").split(",")),f.value=t,v.value=!0},A=async e=>{try{await g.deleteQuestion(e),r.success("删除成功"),_()}catch{r.error("删除失败")}},M=async e=>{try{for(const t of e)await g.addQuestion({...t,type:0});r.success("导入成功"),_()}catch{r.error("导入失败")}},O=async()=>{var e;try{const t=await S.value.validate();(e=f.value)!=null&&e.id?(await g.updateQuestion(f.value.id,{...t,type:"choice"}),r.success("更新成功")):(await g.addQuestion({...t,type:"choice"}),r.success("添加成功")),v.value=!1,_()}catch(t){console.error("表单提交错误:",t),r.error("操作失败")}};return H(()=>{_()}),(e,t)=>{const D=p("a-button"),k=p("a-input-search"),h=p("a-space"),y=p("a-tag"),x=p("a-popconfirm"),C=p("a-table"),q=p("a-modal");return d(),m("div",Z,[u("div",ee,[o(h,null,{default:c(()=>[o(D,{type:"primary",onClick:N},{default:c(()=>t[2]||(t[2]=[T(" 新增选择题 ")])),_:1}),o(k,{value:l.value.keyword,"onUpdate:value":t[0]||(t[0]=a=>l.value.keyword=a),placeholder:"搜索题目",style:{width:"200px"},onSearch:E},null,8,["value"]),o(U,{onImport:M})]),_:1})]),o(C,{columns:B,"data-source":z.value,loading:Q.value,pagination:{total:I.value,current:l.value.current,pageSize:l.value.size,onChange:L,showSizeChanger:!0,showTotal:a=>`共 ${a} 条`,pageSizeOptions:["10","20","50","100"]}},{bodyCell:c(({column:a,record:s})=>[a.key==="title"?(d(),m("div",te,[u("div",ae,w(s.title),1),u("div",se,[(d(!0),m(J,null,K(s.options,n=>(d(),m("div",{key:n.label,class:"option"},[u("span",{class:Y(["option-label",{"is-answer":s.answer.includes(n.label)}])},w(n.label)+". ",3),u("span",ne,w(n.content),1)]))),128))]),s.answer.length?(d(),m("div",oe,[o(y,{color:"success"},{default:c(()=>[T("正确答案: "+w(s.answer.join("、")),1)]),_:2},1024)])):b("",!0),s.note?(d(),m("div",le,[o(y,{color:"warning"},{default:c(()=>[T(w(s.note),1)]),_:2},1024)])):b("",!0)])):b("",!0),a.key==="action"?(d(),W(h,{key:1},{default:c(()=>[u("a",{onClick:n=>R(s)},"编辑",8,ie),o(x,{title:"确定要删除这道题目吗？",onConfirm:n=>A(s.id)},{default:c(()=>t[3]||(t[3]=[u("a",{class:"danger"},"删除",-1)])),_:2},1032,["onConfirm"])]),_:2},1024)):b("",!0)]),_:1},8,["data-source","loading","pagination"]),o(q,{open:v.value,"onUpdate:open":t[1]||(t[1]=a=>v.value=a),title:$.value,onOk:O},{default:c(()=>[o(j,{ref_key:"formRef",ref:S,"initial-values":f.value,type:"choice"},null,8,["initial-values"])]),_:1},8,["open","title"])])}}},_e=G(ce,[["__scopeId","data-v-ef8cf94c"]]);export{_e as default};
